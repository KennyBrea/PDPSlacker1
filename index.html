<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
    <title>PDP - Scheduler</title>

    <!-- CSS  -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="web/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
    <style>
        body {
            position: absolute;
            top: 0px;
            left: 0px;
            height: 100vh;
            width: 100%;
        }

        .center-text {
            font-family: sans-serif;
            text-align: center;
            padding-top: 40vh;
            font-size: 20px;
        }

        #drop_zone {
            height: 100%;
            margin-top: -64px;
        }
        
        #drop_zone.mouse-over {
            border: 2px dashed rgba(0, 0, 0, .5);
            color: rgba(0, 0, 0, .5);
        }
    </style>
</head>

<body>
    <nav class="light-blue lighten-1" role="navigation">
        <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">PDP Schedule Updater</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="https://github.com/cavejay/PDPslacker">Repo Link</a></li>
            </ul>

            <ul id="nav-mobile" class="side-nav">
                <li><a href="https://github.com/cavejay/PDPslacker">Repo Link</a></li>
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
        </div>
    </nav>

    <div id="drop_zone">
        <div id="droptext" class="center-text">Drop files here</div>
        <output id="list" class="center-text"></output>
    </div>


    <!--  Scripts-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="web/js/materialize.js"></script>
    <script src="web/js/mammoth.browser.js"></script>
    <script src="web/js/cheerio.js"></script>

    <script>
        doc = {nextWeek: {}}
        days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

        // Check for the various File API support.
        if (window.File && window.FileReader && window.FileList && window.Blob) {} else {
            alert('The File APIs are not fully supported in this browser.');
        }

        reader = new FileReader();
        reader.onload = function () {
            r = reader.result;
             mammoth.convertToHtml({arrayBuffer: r}).then(function(result){
                var html = result.value; // The generated HTML 
                var messages = result.messages; // Any messages, such as warnings during conversion 
                ch = cheerio.load(html);
                doc.tip = ch('ul li').first().text();
                
                // Get data for this week
                for (day in days) {
                    doc[days[day]] = ch(':contains("'+days[day]+':")').first().next().children().map((i, el) => {
                        return ch(el).text();
                    }).get();
                }

                // Get data for next week
                for (day in days) {
                    doc.nextWeek[days[day]] = ch(':contains("'+days[day]+':")').eq(-2).next().children().map((i, el) => {
                        return ch(el).text();
                    }).get();
                }
                
                // ensure that the doc was read properly
                if (doc.Monday)

                // save the doc with todays date somewhere
                // every day at 8am print that day's topics'
            })
            .done();
        }

        function handleFileSelect(evt) {
            evt.stopPropagation();
            evt.preventDefault();

            var files = evt.dataTransfer.files; // FileList object.

            // files is a FileList of File objects. List some properties.
            var output = [];
            for (var i = 0, f; f = files[i]; i++) {
            output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                        f.size, ' bytes, last modified: ',
                        f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                        '</li>');
            }
            document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
            reader.readAsArrayBuffer(files[0]);
        }

        function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
        }

        // Setup the dnd listeners.
        var dropZone = document.getElementById('drop_zone');
        dropZone.addEventListener('dragover', handleDragOver, false);
        dropZone.addEventListener('drop', handleFileSelect, false);
    </script>
</body>

</html>